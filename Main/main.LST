C51 COMPILER V9.52.0.0   MAIN                                                              06/04/2021 18:20:46 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <REGX51.H>
   2          //Khai bao ket noi IC 74595
   3          
   4          sbit IDX0_IC595_SHCP = P0^0;    //xung clock
   5          sbit IDX0_IC595_DS = P0^1;    // chan data
   6          sbit IDX0_IC595_STCP = P0^2;  // chan chot du lieu 
   7          
   8          sbit IDX1_IC595_SHCP = P0^3;    //xung clock
   9          sbit IDX1_IC595_DS = P0^4;    // chan data
  10          sbit IDX1_IC595_STCP = P0^5;  // chan chot du lieu 
  11          
  12          sbit IDX2_IC595_SHCP = P1^0;    //xung clock
  13          sbit IDX2_IC595_DS = P1^1;    // chan data
  14          sbit IDX2_IC595_STCP = P1^2;  // chan chot du lieu 
  15          
  16          sbit IDX3_IC595_SHCP = P1^3;    //xung clock
  17          sbit IDX3_IC595_DS = P1^4;    // chan data
  18          sbit IDX3_IC595_STCP = P1^5;  // chan chot du lieu 
  19          
  20          sbit ledStart = P3^4;
  21          sbit ledUart = P3^5;
  22          sbit button = P3^6;
  23          sbit led1 = P3^7;
  24          
  25          unsigned char STATE_595_0 = 0x00;
  26          unsigned char STATE_595_1 = 0x00;
  27          unsigned char STATE_595_2 = 0x00;
  28          unsigned char STATE_595_3 = 0x00;
  29          ////////////////////////////////
  30          unsigned char r_data;
  31          unsigned char START_BYTE= 0;
  32          unsigned char MODE= 0;
  33          unsigned char Count = 0 ;
  34          
  35          
  36          
  37          
  38          
  39          void OUT_BYTE_LED(unsigned char value, unsigned char idx)
  40          {
  41   1        if (idx == 0)
  42   1        {
  43   2          unsigned char i;
  44   2          STATE_595_0 = value;
  45   2          for (i = 0 ; i < 8 ; i++)
  46   2          {
  47   3            IDX0_IC595_DS = !(value & (0x80 >>i));
  48   3            IDX0_IC595_SHCP = 1;
  49   3            IDX0_IC595_SHCP = 0 ;
  50   3          }
  51   2          IDX0_IC595_STCP = 1 ;
  52   2          IDX0_IC595_STCP = 0 ; 
  53   2        }
  54   1        else if (idx == 1)
  55   1        {
C51 COMPILER V9.52.0.0   MAIN                                                              06/04/2021 18:20:46 PAGE 2   

  56   2          unsigned char i;
  57   2          STATE_595_1 = value;
  58   2          for (i = 0 ; i < 8 ; i++)
  59   2          {
  60   3            IDX1_IC595_DS = !(value & (0x80 >>i));
  61   3            IDX1_IC595_SHCP = 1;
  62   3            IDX1_IC595_SHCP = 0 ;
  63   3          }
  64   2          IDX1_IC595_STCP = 1 ;
  65   2          IDX1_IC595_STCP = 0 ; 
  66   2        }
  67   1        else if (idx == 2)
  68   1        {
  69   2          unsigned char i;
  70   2          STATE_595_2 = value;
  71   2          for (i = 0 ; i < 8 ; i++)
  72   2          {
  73   3            IDX2_IC595_DS = !(value & (0x80 >>i));
  74   3            IDX2_IC595_SHCP = 1;
  75   3            IDX2_IC595_SHCP = 0 ;
  76   3          }
  77   2          IDX2_IC595_STCP = 1 ;
  78   2          IDX2_IC595_STCP = 0 ; 
  79   2        }
  80   1        
  81   1        else 
  82   1        {
  83   2          unsigned char i;
  84   2          STATE_595_3 = value;
  85   2          for (i = 0 ; i < 8 ; i++)
  86   2          {
  87   3            IDX3_IC595_DS = !(value & (0x80 >>i));
  88   3            IDX3_IC595_SHCP = 1;
  89   3            IDX3_IC595_SHCP = 0 ;
  90   3          }
  91   2          IDX3_IC595_STCP = 1 ;
  92   2          IDX3_IC595_STCP = 0 ; 
  93   2        }
  94   1        
  95   1        
  96   1      }
  97          
  98          
  99          
 100          void OUT_BIT_LED(unsigned char idx, unsigned char idx_595)
 101          {
 102   1        if (idx_595 == 0)
 103   1        {
 104   2          STATE_595_0 |= (0x01 << idx) ; 
 105   2          OUT_BYTE_LED(STATE_595_0, idx_595);
 106   2        }
 107   1        else if (idx_595 == 1)
 108   1        {
 109   2          STATE_595_1 |= (0x01 << idx) ; 
 110   2          OUT_BYTE_LED(STATE_595_1, idx_595);
 111   2        }
 112   1        else if (idx_595 == 2)
 113   1        {
 114   2          STATE_595_2 |= (0x01 << idx) ; 
 115   2          OUT_BYTE_LED(STATE_595_2, idx_595);
 116   2        }
 117   1        else 
C51 COMPILER V9.52.0.0   MAIN                                                              06/04/2021 18:20:46 PAGE 3   

 118   1        {
 119   2          STATE_595_3 |= (0x01 << idx) ; 
 120   2          OUT_BYTE_LED(STATE_595_3, idx_595);
 121   2        }
 122   1      }
 123           /////////////////////////////
 124          
 125          
 126          //khoi tao
 127          void UART_Init()
 128          {
 129   1        TMOD = 0x20;    /* Timer 1, 8-bit auto reload mode */
 130   1        TH1 = 0xFD;   /* Load value for 9600 baud rate */ //F3
 131   1        SCON = 0x50;    /* Mode 1, reception enable */
 132   1        TR1 = 1;
 133   1        IE=0X90;    /* Start timer 1 */
 134   1      }
 135          
 136          
 137          void Mode1_Handler(unsigned char Data)
 138          {
 139   1        if (Data >= 0 && Data < 256)
 140   1        {
 141   2          OUT_BYTE_LED(Data, Count);
 142   2          Count++;
 143   2          if (Count == 4)
 144   2          {
 145   3            Count = 0 ;
 146   3            START_BYTE = 0 ;
 147   3            MODE = 0 ;
 148   3          }
 149   2        }
 150   1        else
 151   1        {
 152   2          // Out of range data 307,2
 153   2          // led on
 154   2        }
 155   1      }
 156          
 157          
 158          
 159          void Receive_Handler(unsigned char Data)
 160          {
 161   1        TI = 0 ; 
 162   1        SBUF = Data ; 
 163   1        Data -= 0x30;
 164   1        while(TI ==0);
 165   1        TI = 0;
 166   1        if (START_BYTE == 0 && Data == 0)     // chua co du lieu va nhan duoc start_byte
 167   1        {
 168   2          ledStart = 0 ;
 169   2          START_BYTE = 1;
 170   2        }
 171   1        else if (START_BYTE == 1 && MODE == 0 && (Data > 0 && Data < 3))  // neu da start va mode chua co, thi ch
             -eck xem mode byte co dung format k __ mode 1 mode 2
 172   1        {
 173   2          MODE = Data;
 174   2        }
 175   1        else if (START_BYTE !=0 && MODE != 0)
 176   1        {
 177   2          if (MODE == 1)
 178   2          {
C51 COMPILER V9.52.0.0   MAIN                                                              06/04/2021 18:20:46 PAGE 4   

 179   3            Mode1_Handler(Data);
 180   3          }
 181   2          else if (MODE == 2)
 182   2            Mode1_Handler(Data);
 183   2          else
 184   2          {
 185   3            // Turn on LED
 186   3            // should not reach here
 187   3          }
 188   2        }
 189   1        else        // chua hop sai
 190   1        {
 191   2          START_BYTE = 0 ;
 192   2          MODE = 0 ;
 193   2        }
 194   1        RI = 0;
 195   1      }
 196          
 197          
 198          void ISR_UART(void) interrupt 4
 199          {
 200   1        if(RI == 1)           //Kiem tra xem la ngat nhan hay truyen
 201   1        { 
 202   2          ledUart = ~ledUart;
 203   2          r_data = SBUF;          //nhan du lieu
 204   2          Receive_Handler(r_data);
 205   2        }
 206   1      
 207   1        else if (TI==1)
 208   1        {
 209   2          TI=0;
 210   2        }
 211   1      }
 212          
 213          
 214          
 215          
 216          void main()
 217          {
 218   1        
 219   1      //  // INIT 32 LED
 220   1        OUT_BYTE_LED(0x00,0);
 221   1        OUT_BYTE_LED(0x00,1);
 222   1        OUT_BYTE_LED(0x00,2);
 223   1        OUT_BYTE_LED(0x00,3);
 224   1        
 225   1        OUT_BYTE_LED(0x00,0);
 226   1        OUT_BYTE_LED(0x00,1);
 227   1        OUT_BYTE_LED(0x00,2);
 228   1        OUT_BYTE_LED(0x00,3);
 229   1        
 230   1        UART_Init();
 231   1           
 232   1        while(1)
 233   1        {
 234   2           
 235   2      
 236   2        }
 237   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.52.0.0   MAIN                                                              06/04/2021 18:20:46 PAGE 5   

   CODE SIZE        =    530    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
