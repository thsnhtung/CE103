C51 COMPILER V9.52.0.0   MAIN                                                              06/30/2021 10:52:24 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <REGX51.H>
   2          //Khai bao ket noi IC 74595
   3          
   4          sbit IDX0_IC595_SHCP = P0^0;    //xung clock
   5          sbit IDX0_IC595_DS = P0^1;    // chan data
   6          sbit IDX0_IC595_STCP = P0^2;  // chan chot du lieu 
   7          
   8          sbit IDX1_IC595_SHCP = P0^3;    //xung clock
   9          sbit IDX1_IC595_DS = P0^4;    // chan data
  10          sbit IDX1_IC595_STCP = P0^5;  // chan chot du lieu 
  11          
  12          sbit IDX2_IC595_SHCP = P1^0;    //xung clock
  13          sbit IDX2_IC595_DS = P1^1;    // chan data
  14          sbit IDX2_IC595_STCP = P1^2;  // chan chot du lieu 
  15          
  16          sbit IDX3_IC595_SHCP = P1^3;    //xung clock
  17          sbit IDX3_IC595_DS = P1^4;    // chan data
  18          sbit IDX3_IC595_STCP = P1^5;  // chan chot du lieu 
  19          
  20          sbit ledStart = P3^4;
  21          sbit ledUart = P3^5;
  22          sbit button = P3^6;
  23          sbit led1 = P3^7;
  24          
  25          unsigned char STATE_595_0 = 0x00;
  26          unsigned char STATE_595_1 = 0x00;
  27          unsigned char STATE_595_2 = 0x00;
  28          unsigned char STATE_595_3 = 0x00;
  29          ////////////////////////////////
  30          unsigned char r_data;
  31          unsigned char START_BYTE= 0;
  32          unsigned char MODE= 0;
  33          unsigned char Count = 0 ;
  34          ////////////////////////////////
  35          unsigned char lengthOfEffect = 0 ;
  36          unsigned char storage[100];
  37          unsigned char isStateOrDelay = 0 ; // = 0 means wait for led value, =1 means wait for delay value
  38          
  39          
  40          
  41          void OUT_BYTE_LED(unsigned char value, unsigned char idx)
  42          {
  43   1        if (idx == 0)
  44   1        {
  45   2          unsigned char i;
  46   2          STATE_595_0 = value;
  47   2          for (i = 0 ; i < 8 ; i++)
  48   2          {
  49   3            IDX0_IC595_DS = !(value & (0x80 >>i));
  50   3            IDX0_IC595_SHCP = 1;
  51   3            IDX0_IC595_SHCP = 0 ;
  52   3          }
  53   2          IDX0_IC595_STCP = 1 ;
  54   2          IDX0_IC595_STCP = 0 ; 
  55   2        }
C51 COMPILER V9.52.0.0   MAIN                                                              06/30/2021 10:52:24 PAGE 2   

  56   1        else if (idx == 1)
  57   1        {
  58   2          unsigned char i;
  59   2          STATE_595_1 = value;
  60   2          for (i = 0 ; i < 8 ; i++)
  61   2          {
  62   3            IDX1_IC595_DS = !(value & (0x80 >>i));
  63   3            IDX1_IC595_SHCP = 1;
  64   3            IDX1_IC595_SHCP = 0 ;
  65   3          }
  66   2          IDX1_IC595_STCP = 1 ;
  67   2          IDX1_IC595_STCP = 0 ; 
  68   2        }
  69   1        else if (idx == 2)
  70   1        {
  71   2          unsigned char i;
  72   2          STATE_595_2 = value;
  73   2          for (i = 0 ; i < 8 ; i++)
  74   2          {
  75   3            IDX2_IC595_DS = !(value & (0x80 >>i));
  76   3            IDX2_IC595_SHCP = 1;
  77   3            IDX2_IC595_SHCP = 0 ;
  78   3          }
  79   2          IDX2_IC595_STCP = 1 ;
  80   2          IDX2_IC595_STCP = 0 ; 
  81   2        }
  82   1        
  83   1        else 
  84   1        {
  85   2          unsigned char i;
  86   2          STATE_595_3 = value;
  87   2          for (i = 0 ; i < 8 ; i++)
  88   2          {
  89   3            IDX3_IC595_DS = !(value & (0x80 >>i));
  90   3            IDX3_IC595_SHCP = 1;
  91   3            IDX3_IC595_SHCP = 0 ;
  92   3          }
  93   2          IDX3_IC595_STCP = 1 ;
  94   2          IDX3_IC595_STCP = 0 ; 
  95   2        }
  96   1        
  97   1        
  98   1      }
  99          
 100          
 101          
 102          void OUT_BIT_LED(unsigned char idx, unsigned char idx_595)
 103          {
 104   1        if (idx_595 == 0)
 105   1        {
 106   2          STATE_595_0 |= (0x01 << idx) ; 
 107   2          OUT_BYTE_LED(STATE_595_0, idx_595);
 108   2        }
 109   1        else if (idx_595 == 1)
 110   1        {
 111   2          STATE_595_1 |= (0x01 << idx) ; 
 112   2          OUT_BYTE_LED(STATE_595_1, idx_595);
 113   2        }
 114   1        else if (idx_595 == 2)
 115   1        {
 116   2          STATE_595_2 |= (0x01 << idx) ; 
 117   2          OUT_BYTE_LED(STATE_595_2, idx_595);
C51 COMPILER V9.52.0.0   MAIN                                                              06/30/2021 10:52:24 PAGE 3   

 118   2        }
 119   1        else 
 120   1        {
 121   2          STATE_595_3 |= (0x01 << idx) ; 
 122   2          OUT_BYTE_LED(STATE_595_3, idx_595);
 123   2        }
 124   1      }
 125           /////////////////////////////
 126          
 127          
 128          //khoi tao
 129          void UART_Init()
 130          {
 131   1        TMOD = 0x20;    /* Timer 1, 8-bit auto reload mode */
 132   1        TH1 = 0xFD;   /* Load value for 9600 baud rate */ //F3
 133   1        SCON = 0x50;    /* Mode 1, reception enable */
 134   1        TR1 = 1;
 135   1        IE=0X90;    /* Start timer 1 */
 136   1      }
 137          
 138          
 139          void HardMode_Handler(unsigned char Data)
 140          {
 141   1        if (Data >= 0 && Data < 256)
 142   1        {
 143   2          OUT_BYTE_LED(Data, Count);
 144   2          Count++;
 145   2          if (Count == 4)
 146   2          {
 147   3            Count = 0 ;         
 148   3            START_BYTE = 0 ;
 149   3            MODE = 0 ;              // clear mode
 150   3          }
 151   2        }
 152   1        else
 153   1        {
 154   2          // Out of range data 307,2
 155   2          // led on
 156   2        }
 157   1      }
 158          
 159          void CustomMode_Handler(unsigned char Data)
 160          {
 161   1        
 162   1      }
*** WARNING C280 IN LINE 159 OF main.c: 'Data': unreferenced local variable
 163          
 164          
 165          void Receive_Handler(unsigned char Data)
 166          {
 167   1        TI = 0 ;                // send uart de kiem tra
 168   1        SBUF = Data ; 
 169   1        Data -= 0x30;           // se xoa 
 170   1        while(TI ==0);
 171   1        TI = 0;
 172   1        if (START_BYTE == 0 && Data == 0)     // chua co du lieu va nhan duoc start_byte
 173   1        {
 174   2          ledStart = 0 ;
 175   2          START_BYTE = 1;
 176   2        }
 177   1        else if (START_BYTE == 1 && MODE == 0 && (Data > 0 && Data < 3))  // neu da start va mode chua co, thi ch
             -eck xem mode byte co dung format k __ mode 1 mode 2
C51 COMPILER V9.52.0.0   MAIN                                                              06/30/2021 10:52:24 PAGE 4   

 178   1        {
 179   2          MODE = Data;
 180   2        }
 181   1        else if (START_BYTE !=0 && MODE != 0)
 182   1        {
 183   2          if (MODE == 1 || MODE == 2 || MODE == 3)
 184   2          {
 185   3            HardMode_Handler(Data);
 186   3          }
 187   2          else if (MODE == 4)
 188   2            CustomMode_Handler(Data);
 189   2          else
 190   2          {
 191   3            // Turn on LED
 192   3            // should not reach here
 193   3          }
 194   2        }
 195   1        else        // chua hop sai
 196   1        {
 197   2          START_BYTE = 0 ;
 198   2          MODE = 0 ;
 199   2        }
 200   1        RI = 0;
 201   1      }
 202          
 203          
 204          void ISR_UART(void) interrupt 4
 205          {
 206   1        if(RI == 1)           //Kiem tra xem la ngat nhan hay truyen
 207   1        { 
 208   2          ledUart = ~ledUart;
 209   2          r_data = SBUF;          //nhan du lieu
 210   2          Receive_Handler(r_data);
 211   2        }
 212   1      
 213   1        else if (TI==1)
 214   1        {
 215   2          TI=0;
 216   2        }
 217   1      }
 218          
 219          
 220          
 221          
 222          void main()
 223          {
 224   1        
 225   1      //  // INIT 32 LED
 226   1        OUT_BYTE_LED(0x00,0);
 227   1        OUT_BYTE_LED(0x00,1);
 228   1        OUT_BYTE_LED(0x00,2);
 229   1        OUT_BYTE_LED(0x00,3);
 230   1        
 231   1        OUT_BYTE_LED(0x00,0);
 232   1        OUT_BYTE_LED(0x00,1);
 233   1        OUT_BYTE_LED(0x00,2);
 234   1        OUT_BYTE_LED(0x00,3);
 235   1        
 236   1        UART_Init();
 237   1           
 238   1        while(1)
 239   1        {
C51 COMPILER V9.52.0.0   MAIN                                                              06/30/2021 10:52:24 PAGE 5   

 240   2           
 241   2      
 242   2        }
 243   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    548    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =    110       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
